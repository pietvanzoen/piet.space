0.0.0.0:{$PORT} {
  git https://github.com/pietvanzoen/pietvanzoen.com.git {
    path /site
    branch {$BRANCH}
    interval 300
    clone_args --depth=1
    then git clean -fd
  }

  root /site
  tls off
  log / stdout "{combined}"
  gzip
  errors stderr {
    404 404.html
  }

  rewrite /feed /feed.xml

  redir 302 {
    /blog/archive /blog/
    /blog/archive/ /blog/
    /blog/archive/index.html /blog/
    /reading /links/
    /reading/ /links/
    /reading/index.html /links/
  }

  header / {
    Strict-Transport-Security "max-age=31536000;"
    Content-Security-Policy-Report-Only "default-src 'self'; script-src 'self' fathom.piet.me; img-src 'self' fathom.piet.me; report-uri https://pietvanzoen.report-uri.com/r/d/csp/reportOnly"
    Cache-Control "max-age=30; public"
  }

  header /images Cache-Control "max-age=86400; public"
  header /stylesheets Cache-Control "max-age=86400; public"
  header /fonts Cache-Control "max-age=86400; public"
  header /cached Cache-Control "max-age=86400; public"
}
